<!-- Description -->
<div class="content">
  <a (click)="onSelectCountry({country: 'France', slug: 'france', translation: 'France'})"
    class="button button-back is-info" *ngIf="selectedDepartment || selectedRegion">Retourner aux statistiques
    nationales</a>
  <div class="is-spaced">
    <p class="description" *ngIf="selectedCountry?.country === 'Monde'">
      Suivez en direct l'épidémie du <strong>Coronavirus COVID-19</strong> avec le nombre de cas recensés, le nombre
      de morts et de cas guéris en <strong>France</strong> et dans le monde entier: <strong>Italie, Espagne,
        Chine</strong> à travers un dashboard et des graphiques détaillés.
    </p>
    <p class="description" *ngIf="selectedCountry?.country !== 'Monde' && selectedCountry?.country !== 'France'">
      Suivez en direct l'épidémie du <strong>Coronavirus COVID-19</strong> avec le nombre de cas recensés, le nombre
      de morts et de cas guéris en <strong>{{selectedCountry?.translation}}</strong> à travers un dashboard et des
      graphiques détaillés.
    </p>
    <p class="description" *ngIf="selectedCountry?.country === 'France'">
      Suivez en direct l'épidémie en <strong>
        {{selectedCountry?.translation}} {{selectedRegion?.name}} {{selectedDepartment?.name}}
      </strong> du <strong>Coronavirus COVID-19</strong> avec les données Worldometer et les données hospitalières
      quotidiennes relatives à
      l'épidémie du COVID-19 par région, département, genre du patient et tranche d’âge des patients.
    </p>
  </div>

  <!-- World and Country Container -->
  <ng-container *ngIf="(detailedStats$ | loading | async) as detailedStats">
    <ng-container *ngIf="detailedStats.value && detailedStats.value.length > 0">

      <ng-container *ngIf="selectedCountry.country !== 'France'">
        <app-coronavirus-stats [mainStats]="detailedStats.value | countryfilter: selectedCountry.code"
          [selectedCountry]="selectedCountry"></app-coronavirus-stats>

        <!-- World container -->
        <ng-container *ngIf="selectedCountry.country === 'Monde'">
          <div class="columns">
            <div class="column" *ngIf="isBrowser && selectedCountry.country === 'Monde'">
              <app-coronavirus-map [selectedDivisionMap]="'world'" [selectedCountry]="selectedCountry"
                [detailedStats]="detailedStats.value | countryfilter: ''">
              </app-coronavirus-map>
            </div>

          </div>
          <div class="columns" *ngIf="selectedCountry.country === 'Monde'">
            <div class="column" *ngIf="selectedCountry.country === 'Monde'">
              <h2>Tableau récapitulatif de l'épidémie dans le monde</h2>
              <app-coronavirus-table [detailedStats]="detailedStats.value | countryfilter: ''"
                [selectedCountry]="selectedCountry">
              </app-coronavirus-table>
            </div>
            <ng-container *ngIf="(data$ | loading | async) as data">
              <ng-container *ngIf="data.value">
                <div class="column" *ngIf="isBrowser">
                  <app-coronavirus-graph [data]="data.value"></app-coronavirus-graph>
                </div>
              </ng-container>
              <ng-container *ngIf="!data.value && !data.loading">
                <article class="message is-danger is-spaced">
                  <div class="message-header">
                    <p>Données indisponibles</p>
                  </div>
                  <div class="message-body">
                    Nous n'avons pas trouvé de données.
                  </div>
                </article>
              </ng-container>
              <ng-container *ngIf="data.loading">
                <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
              </ng-container>
            </ng-container>

          </div>
        </ng-container>
        <!-- Country container -->
        <ng-container *ngIf="selectedCountry.country !== 'Monde'">
          <div class="columns">
            <div class="column is-spaced">
              <ng-container *ngIf="(tableStatsByCountry$ | loading | async) as tableStatsByCountry">
                <ng-container *ngIf="tableStatsByCountry.value && tableStatsByCountry.value.length > 0">
                  <h2>Tableau récapitulatif de l'épidémie dans le pays</h2>
                  <app-coronavirus-table [detailedStats]="tableStatsByCountry.value"
                    [selectedCountry]="selectedCountry">
                  </app-coronavirus-table>
                </ng-container>
                <ng-container *ngIf="!tableStatsByCountry.value && !tableStatsByCountry.loading">
                  <article class="message is-danger is-spaced">
                    <div class="message-header">
                      <p>Données indisponibles</p>
                    </div>
                    <div class="message-body">
                      Nous n'avons pas trouvé de données.
                    </div>
                  </article>
                </ng-container>
                <ng-container *ngIf="tableStatsByCountry.loading">
                  <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
                </ng-container>
              </ng-container>
            </div>
            <div class="column is-spaced is-two-thirds">
              <ng-container *ngIf="(dailyDatasByCountry$ | loading | async) as dailyDatasByCountry">
                <ng-container *ngIf="dailyDatasByCountry.value && dailyDatasByCountry.value.length > 0">
                  <app-coronavirus-graph [dailyDatasByCountry]="dailyDatasByCountry.value"></app-coronavirus-graph>
                </ng-container>
                <ng-container *ngIf="!dailyDatasByCountry.value && !dailyDatasByCountry.loading">
                  <article class="message is-danger is-spaced">
                    <div class="message-header">
                      <p>Données indisponibles</p>
                    </div>
                    <div class="message-body">
                      Nous n'avons pas trouvé de données.
                    </div>
                  </article>
                </ng-container>
                <ng-container *ngIf="dailyDatasByCountry.loading">
                  <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
                </ng-container>
              </ng-container>
            </div>

          </div>

        </ng-container>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="detailedStats.loading">
      <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
    </ng-container>
    <ng-container *ngIf="(detailedStats.value && detailedStats.value.length === 0) && !detailedStats.loading">
      <article class="message is-danger is-spaced">
        <div class="message-header">
          <p>Données indisponibles</p>
        </div>
        <div class="message-body">
          Nous n'avons pas trouvé de données.
        </div>
      </article>
    </ng-container>
  </ng-container>

  <!-- France Container -->
  <ng-container *ngIf="selectedCountry.country === 'France'">
    <ng-container *ngIf="(franceStats$ | loading | async) as franceStats">
      <ng-container *ngIf="franceStats.value">
        <app-coronavirus-stats [lastUpdate]="franceStats.value.lastUpdate" [selectedCountry]="selectedCountry"
          [mainStats]="franceStats.value.total" [selectedZone]="selectedRegion ? selectedRegion : selectedDepartment">
        </app-coronavirus-stats>
        <div class="columns" *ngIf="!selectedRegion && !selectedDepartment">
          <div class="column is-spaced" *ngIf="isBrowser">
            <h2 class="title">Cartographie de l'épidémie en France</h2>
            <p>
              Les données sont remontées par les <strong>centres hospitaliers</strong> participants à SI-VIC.
            </p>
            <mat-label class="label" for="country-select">Sélectionner un découpage</mat-label>
            <mat-select role="listbox" [(ngModel)]="selectedDivisionMap">
              <mat-option role="option" [value]="'departmentFrance'">
                Par département
              </mat-option>
              <mat-option role="option" [value]="'regionFrance'">
                Par région
              </mat-option>
            </mat-select>
            <app-coronavirus-map [selectedCountry]="selectedCountry" [selectedDivisionMap]="selectedDivisionMap"
              [detailedStats]="selectedDivisionMap === 'regionFrance' ?
              franceStats.value.region.total : franceStats.value.department.total"></app-coronavirus-map>
          </div>
          <div class="column is-spaced is-half">
            <h2 class="title">Tableau récapitulatif de l'épidémie en France</h2>
            <p>
              Les données sont remontées par les <strong>centres hospitaliers</strong> participants à SI-VIC.
              Le <strong>taux de décès</strong> correspond au nombre de décès survenus suite à une hospitalisation sur le nombre total d'hospitalisations.
              Le <strong>taux de guéris</strong> correspond au nombre de guéris suite à une hospitalisation sur le nombre total d'hospitalisations.
            </p>
            <app-coronavirus-table [selectedDivisionMap]="selectedDivisionMap" [detailedStats]="selectedDivisionMap === 'regionFrance' ?
              franceStats.value.region.total : franceStats.value.department.total" [selectedCountry]="selectedCountry">
            </app-coronavirus-table>
          </div>
        </div>
        <div class="columns" *ngIf="isBrowser">
          <div class="column is-spaced" [class.is-two-thirds]="!selectedRegion">
            <app-coronavirus-graph [dataFrance]="franceStats.value.timeline">
            </app-coronavirus-graph>
          </div>
          <div class="column is-spaced" *ngIf="!selectedRegion">
            <app-coronavirus-chart-pie [dataGender]="{ men: franceStats.value.men, women: franceStats.value.women }">
            </app-coronavirus-chart-pie>
          </div>
          <div class="column is-spaced is-half" *ngIf="selectedRegion">
            <h2 class="title">Tableau récapitulatif de l'épidémie dans la région</h2>
            <p>
              Les données sont remontées par les <strong>centres hospitaliers</strong> participants à SI-VIC.
              Le <strong>taux de décès</strong> correspond au nombre de décès survenus suite à une hospitalisation sur le nombre total d'hospitalisations.
              Le <strong>taux de guéris</strong> correspond au nombre de guéris suite à une hospitalisation sur le nombre total d'hospitalisations.
            </p>
            <app-coronavirus-table [selectedDivisionMap]="'departmentFrance'"
              [detailedStats]="franceStats.value.details" [selectedCountry]="selectedCountry">
            </app-coronavirus-table>
          </div>
        </div>
        <div class="columns">
          <div class="column is-spaced" [class.is-two-thirds]="!selectedRegion" [class.is-half]="selectedRegion">
            <ng-container>
              <h2 class="title">Évolution quotidienne des patients atteints de Coronavirus COVID-19</h2>
              <p>
                Les données remontées par les <strong>centres hospitaliers</strong> participants à SI-VIC sont : le
                nombre quotidien de personnes nouvellement hospitalisées, le nombre
                quotidien de nouvelles admissions en réanimation, le nombre quotidien de personnes nouvellement
                décédées, le nombre quotidien de nouveaux retours à domicile.
              </p>
              <app-coronavirus-chart-test-column [nameChart]="'chart-day'" [data]="franceStats.value.timelineDay">
              </app-coronavirus-chart-test-column>
            </ng-container>
          </div>
          <div class="column is-spaced" *ngIf="selectedRegion">
            <app-coronavirus-chart-pie [dataGender]="{ men: franceStats.value.men, women: franceStats.value.women }">
            </app-coronavirus-chart-pie>
          </div>
          <div class="column is-spaced">
            <app-coronavirus-chart-age [dataAge]="franceStats.value.age"></app-coronavirus-chart-age>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="franceStats.loading">
        <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
      </ng-container>
      <ng-container *ngIf="(franceStats.value && franceStats.value.length === 0) && !franceStats.loading">
        <article class="message is-danger is-spaced">
          <div class="message-header">
            <p>Données indisponibles</p>
          </div>
          <div class="message-body">
            Nous n'avons pas trouvé de données.
          </div>
        </article>
      </ng-container>
    </ng-container>
  </ng-container>
</div>
